# Development Workflow

Данное руководство описывает процесс разработки, работу с Git и стандарты коммитов в проекте AniWay.

## Git Workflow

### Основные ветки

- **main** - стабильная продакшн версия
- **develop** - основная ветка разработки
- **experimental-branch** - экспериментальные функции
- **feature/название-функции** - разработка новых функций
- **fix/название-бага** - исправление багов
- **hotfix/критичный-баг** - срочные исправления для продакшна

### Процесс создания новой функции

1. **Создание ветки**
   ```bash
   git checkout develop
   git pull origin develop
   git checkout -b feature/user-profile-page
   ```

2. **Разработка**
   - Делайте небольшие, логичные коммиты
   - Регулярно делайте push изменений
   - Тестируйте код локально

3. **Создание Pull Request**
   - Убедитесь что код работает
   - Добавьте описание изменений
   - Запросите код-ревью у коллег

4. **Мерж после ревью**
   - Получите approve от минимум одного коллеги
   - Убедитесь что проходят все проверки
   - Используйте "Squash and merge"

### Процесс исправления багов

1. **Создание ветки от develop**
   ```bash
   git checkout develop
   git pull origin develop
   git checkout -b fix/login-validation-error
   ```

2. **Исправление**
   - Воспроизведите баг локально
   - Исправьте проблему
   - Добавьте тесты если необходимо

3. **Pull Request**
   - Опишите проблему и решение
   - Приложите скриншоты до/после
   - Укажите связанные issues

## Соглашения о коммитах

### Формат коммита

```
тип(область): краткое описание

Подробное описание изменений если необходимо

Связанные issues: #123, #456
```

### Типы коммитов

- **feat** - новая функция
- **fix** - исправление бага
- **docs** - изменения документации
- **style** - форматирование кода (без изменения логики)
- **refactor** - рефакторинг кода
- **test** - добавление или изменение тестов
- **chore** - изменения сборки или вспомогательных инструментов

### Области (scope)

**Frontend:**
- **ui** - компоненты пользовательского интерфейса
- **auth** - аутентификация
- **manga** - функции связанные с мангой
- **reader** - ридер манги
- **profile** - профиль пользователя

**Backend:**
- **auth-service** - сервис аутентификации
- **manga-service** - сервис манги
- **chapter-service** - сервис глав
- **image-service** - сервис изображений
- **gateway** - API Gateway

### Примеры коммитов

```bash
# Хорошие коммиты
feat(auth): добавить регистрацию через email
fix(manga): исправить отображение обложек в каталоге
docs(api): обновить документацию endpoints
refactor(ui): выделить компонент MangaCard

# Плохие коммиты
fix: баг
update code
feat: новая фича
```

## Code Review

### Что проверять при ревью

**Общее:**
- Код соответствует требованиям задачи
- Нет дублирования кода
- Читабельность и понятность
- Производительность

**Frontend:**
- Компоненты переиспользуемы
- Правильное использование TypeScript
- Корректная работа с состоянием
- Адаптивность интерфейса

**Backend:**
- Правильная архитектура
- Обработка ошибок
- Валидация данных
- Безопасность API

### Как оставлять комментарии

```markdown
# Хорошие комментарии
Предлагаю вынести эту логику в отдельный сервис для переиспользования

Нужно добавить проверку на null перед использованием этого объекта

Можно оптимизировать этот запрос, добавив индекс на поле 'username'

# Плохие комментарии
Плохо
Переделай
Не нравится
```

## Конфликты и их решение

### При конфликте с develop

1. **Обновите develop**
   ```bash
   git checkout develop
   git pull origin develop
   ```

2. **Сделайте rebase**
   ```bash
   git checkout feature/your-branch
   git rebase develop
   ```

3. **Разрешите конфликты**
   ```bash
   # Отредактируйте файлы с конфликтами
   git add .
   git rebase --continue
   ```

4. **Force push (ОСТОРОЖНО)**
   ```bash
   git push origin feature/your-branch --force-with-lease
   ```

### Правила при конфликтах

- **НЕ** используйте `git push --force` без `--force-with-lease`
- **ОБЯЗАТЕЛЬНО** тестируйте код после разрешения конфликтов
- **СООБЩИТЕ** команде о серьезных конфликтах
- **ПОПРОСИТЕ** помощи если не уверены

## Работа с Issues

### Создание задач

1. **Используйте шаблоны** - bug report, feature request
2. **Добавляйте лейблы** - frontend, backend, bug, enhancement
3. **Назначайте исполнителя** или оставляйте пустым для обсуждения
4. **Связывайте с проектами** если есть

### Описание задач

```markdown
## Описание
Четкое описание что нужно сделать

## Критерии приемки
- [ ] Пользователь может войти в систему
- [ ] Отображается сообщение об ошибке при неверных данных
- [ ] Редирект на главную после успешного входа

## Дополнительная информация
Скриншоты, макеты, ссылки на документацию
```

## Тестирование

### Обязательные проверки перед коммитом

**Frontend:**
- Приложение собирается без ошибок
- Нет console.error в браузере
- Компоненты отображаются корректно
- Responsive design работает

**Backend:**
- Сервис запускается без ошибок
- API endpoints возвращают ожидаемые данные
- Валидация работает корректно
- Нет SQL ошибок в логах

### Тестирование интеграции

```bash
# Запуск всех сервисов
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up -d --build

# Проверка health endpoints
curl http://localhost:8080/actuator/health
curl http://localhost:8081/actuator/health

# Тестирование основных функций
# Регистрация, вход, просмотр манги, добавление в закладки
```

## Деплой

### Development Environment

- **Автоматический** - при пуше в develop
- **Адрес**: https://dev.aniway.com
- **Доступ**: только для команды

### Production Environment

- **Ручной** - после тестирования в dev
- **Требует**: approve от Team Lead
- **Адрес**: https://aniway.com

---

**Помните**: Следование workflow обеспечивает стабильность проекта и удобство работы всей команды.
