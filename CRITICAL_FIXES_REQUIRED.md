# –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 1: melonSlug –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ

### –û–ø–∏—Å–∞–Ω–∏–µ
–í –º–µ—Ç–æ–¥–µ `MelonIntegrationService.createMangaFromData()` **–ù–ï —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è** `melonSlug`, —Ö–æ—Ç—è filename (–∫–æ—Ç–æ—Ä—ã–π –∏ –µ—Å—Ç—å slug) –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä.

### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è
- –ê–≤—Ç–æ–ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã (–≤—Å–µ–≥–¥–∞ `melonSlug = null`)
- –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –º–∞–Ω–≥–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (—Ñ–∏–ª—å—Ç—Ä –ø–æ `melonSlug != null` –≤–µ—Ä–Ω–µ—Ç 0 –º–∞–Ω–≥)
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–≤—è–∑–∞—Ç—å –º–∞–Ω–≥—É —Å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –≤ Melon

### –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ
`MangaService/src/main/java/shadowshift/studio/mangaservice/service/MelonIntegrationService.java`
–ú–µ—Ç–æ–¥: `createMangaFromData(Map<String, Object> mangaInfo, String filename)`
–°—Ç—Ä–æ–∫–∞: ~774

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
```java
private Manga createMangaFromData(Map<String, Object> mangaInfo, String filename) {
    Manga manga = new Manga();

    // ‚úÖ –ö–†–ò–¢–ò–ß–ù–û: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º melonSlug –∏–∑ filename
    manga.setMelonSlug(filename);

    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º title - –∏—Å–ø–æ–ª—å–∑—É–µ–º localized_name (—Ä—É—Å—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ)
    String title = (String) mangaInfo.get("localized_name");
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
}
```

---

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ endpoints –≤ MelonService

### –û–ø–∏—Å–∞–Ω–∏–µ
`MangaUpdateService` –≤—ã–∑—ã–≤–∞–µ—Ç endpoints, –∫–æ—Ç–æ—Ä—ã—Ö –ù–ï–¢ –≤ MelonService:
- `POST /check-updates` - –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- `POST /parse-new-chapters` - –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

### –¢–µ–∫—É—â–∏–µ endpoints –≤ MelonService (api_server.py)
```python
POST /parse          # –ø–∞—Ä—Å–∏–Ω–≥ –æ–¥–Ω–æ–π –º–∞–Ω–≥–∏
POST /build          # –±–∏–ª–¥ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
POST /batch-parse    # –ø–∞–∫–µ—Ç–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥
POST /batch-start    # –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–∞–∫–µ—Ç–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥
GET  /list-parsed    # —Å–ø–∏—Å–æ–∫ —Å–ø–∞—Ä—Å–µ–Ω–Ω—ã—Ö
GET  /manga-info/{slug}  # –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∞–Ω–≥–µ
DELETE /delete/{slug}    # —É–¥–∞–ª–µ–Ω–∏–µ –º–∞–Ω–≥–∏
```

### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è
- `MangaUpdateService.checkForUpdates()` –≤—ã–∑–æ–≤–µ—Ç 404 –æ—à–∏–±–∫—É
- `MangaUpdateService.requestParseNewChapters()` –≤—ã–∑–æ–≤–µ—Ç 404 –æ—à–∏–±–∫—É
- –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ **–Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤–æ–æ–±—â–µ**

### –†–µ—à–µ–Ω–∏–µ
–ï—Å—Ç—å 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞:

**–í–∞—Ä–∏–∞–Ω—Ç 1 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π):** –£–ø—Ä–æ—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```java
// –í–º–µ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤—ã—Ö –≥–ª–∞–≤ —á–µ—Ä–µ–∑ Melon:
// 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –º–∞–Ω–≥–∏: POST /parse
// 2. –ü–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ: GET /manga-info/{slug}
// 3. –°—Ä–∞–≤–Ω–∏—Ç—å –≥–ª–∞–≤—ã –≤ Java –∫–æ–¥–µ
// 4. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ
// 5. –£–¥–∞–ª–∏—Ç—å –∏–∑ Melon: DELETE /delete/{slug}
```

**–í–∞—Ä–∏–∞–Ω—Ç 2:** –î–æ–±–∞–≤–∏—Ç—å endpoints –≤ MelonService (—Å–º. MELON_SERVICE_API_CHANGES.md)

---

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 3: –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≥–ª–∞–≤

### –û–ø–∏—Å–∞–Ω–∏–µ
–í `MangaUpdateService.importNewChaptersOnly()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≥–ª–∞–≤, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≥–ª–∞–≤—ã –∏–∑-–∑–∞ —Ä–∞–∑–ª–∏—á–∏–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ –Ω–æ–º–µ—Ä–æ–≤.

### –ö–æ–¥ —Å –ø—Ä–æ–±–ª–µ–º–æ–π
```java
for (Map<String, Object> chapter : branchChapters) {
    Object numberObj = chapter.get("number");
    if (numberObj != null) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–∞ –≥–ª–∞–≤–∞ –Ω–æ–≤–æ–π
        boolean isNewChapter = newChapters.stream()
            .anyMatch(nc -> Objects.equals(nc.get("number"), numberObj));
        // ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞: —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—Ç—å –µ—Å–ª–∏ —Ç–∏–ø—ã —Ä–∞–∑–Ω—ã–µ
        // –ù–∞–ø—Ä–∏–º–µ—Ä: "5.0" (String) vs 5.0 (Double)
    }
}
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
```java
boolean isNewChapter = newChapters.stream()
    .anyMatch(nc -> {
        String ncNumber = String.valueOf(nc.get("number"));
        String chNumber = String.valueOf(numberObj);
        return ncNumber.equals(chNumber);
    });
```

---

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 4: filename vs slug –ø—É—Ç–∞–Ω–∏—Ü–∞

### –û–ø–∏—Å–∞–Ω–∏–µ
–í –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä `filename`, –Ω–æ –ø–æ —Å—É—Ç–∏ —ç—Ç–æ `slug` –º–∞–Ω–≥–∏ –∏–∑ MangaLib.

**–ü—Ä–∏–º–µ—Ä slug –º–∞–Ω–≥–∏ –Ω–∞ MangaLib:**
```
https://mangalib.me/solo-leveling
                     ^^^^^^^^^^^^
                     —ç—Ç–æ slug
```

### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- `MelonIntegrationService.getMangaInfo(String filename)` - –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —ç—Ç–æ slug
- `MelonIntegrationService.importToSystemAsync(String filename, ...)` - —ç—Ç–æ slug
- `MelonIntegrationService.deleteManga(String filename)` - —ç—Ç–æ slug

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è
–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —É–ª—É—á—à–∏—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å):
```java
// –ë—ã–ª–æ
public Map<String, Object> getMangaInfo(String filename)

// –õ—É—á—à–µ
public Map<String, Object> getMangaInfo(String slug)
```

---

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 5: MangaUpdateService.importChapterPages() –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω

### –û–ø–∏—Å–∞–Ω–∏–µ
```java
private void importChapterPages(Long chapterId, List<Map<String, Object>> slides, 
                               String mangaFilename, String originalChapterName) {
    // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞ MelonIntegrationService.importChapterPagesFromMelonService
    // –î–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏ –æ–ø—É—â–µ–Ω–∞, —Ç–∞–∫ –∫–∞–∫ –ª–æ–≥–∏–∫–∞ –∏–¥–µ–Ω—Ç–∏—á–Ω–∞
    logger.info("–ò–º–ø–æ—Ä—Ç {} —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –≥–ª–∞–≤—ã {}", slides.size(), chapterId);
}
```

### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è
–°—Ç—Ä–∞–Ω–∏—Ü—ã –≥–ª–∞–≤ –ù–ï –ë–£–î–£–¢ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏!

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
–ù—É–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∏–∑ `MelonIntegrationService.importChapterPagesFromMelonService()` –∏–ª–∏ –≤—ã–∑–≤–∞—Ç—å –µ–≥–æ –Ω–∞–ø—Ä—è–º—É—é.

---

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

1. ‚úÖ **AutoParsingService** - –ª–æ–≥–∏–∫–∞ –≤–µ—Ä–Ω–∞—è (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã #1)
2. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –º–∞–Ω–≥** - `existsByMelonSlug()` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
3. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≥–ª–∞–≤** - `chapterExists()` –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
4. ‚úÖ **Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç** - UI –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
5. ‚úÖ **ParserController endpoints** - –≤—Å–µ endpoints –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—ä—è–≤–ª–µ–Ω—ã
6. ‚úÖ **ChapterService.chapterExists()** - –º–µ—Ç–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üìã –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ (–±–µ–∑ –Ω–∏—Ö –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç):
1. **–ü—Ä–æ–±–ª–µ–º–∞ #1** - –¥–æ–±–∞–≤–∏—Ç—å `manga.setMelonSlug(filename)`
2. **–ü—Ä–æ–±–ª–µ–º–∞ #2** - —É–ø—Ä–æ—Å—Ç–∏—Ç—å `MangaUpdateService` –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å endpoints –≤ Melon
5. **–ü—Ä–æ–±–ª–µ–º–∞ #5** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `importChapterPages()`

### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ (—É–ª—É—á—à–∞—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å):
3. **–ü—Ä–æ–±–ª–µ–º–∞ #3** - –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤ –≥–ª–∞–≤
4. **–ü—Ä–æ–±–ª–µ–º–∞ #4** - –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üîß –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å `createMangaFromData()` - –¥–æ–±–∞–≤–∏—Ç—å `setMelonSlug()`
2. –£–ø—Ä–æ—Å—Ç–∏—Ç—å `MangaUpdateService`:
   - –£–±—Ä–∞—Ç—å –≤—ã–∑–æ–≤—ã –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö endpoints
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–∞—Ä—Å–∏–Ω–≥
   - –°—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –≥–ª–∞–≤—ã –≤ Java –∫–æ–¥–µ
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `importChapterPages()` –≤ `MangaUpdateService`
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–ø–∞—Ä—Å–∏–Ω–≥
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
