# Настройка Yandex Object Storage для AniWay

## 1. Создание сервисного аккаунта в Yandex Cloud

1. Войдите в [Yandex Cloud Console](https://console.cloud.yandex.ru/)
2. Выберите ваш каталог (folder)
3. Перейдите в раздел "Сервисные аккаунты"
4. Нажмите "Создать сервисный аккаунт"
5. Укажите имя: `aniway-storage-account`
6. Назначьте роли:
   - `storage.editor` - для управления объектами в бакете
   - `storage.viewer` - для чтения объектов

## 2. Создание статических ключей доступа

1. Выберите созданный сервисный аккаунт
2. Перейдите на вкладку "Ключи доступа"
3. Нажмите "Создать новый ключ" → "Статический ключ доступа"
4. Сохраните:
   - **Идентификатор ключа** (Access Key ID)
   - **Секретный ключ** (Secret Access Key)

## 3. Создание бакета

1. Перейдите в раздел "Object Storage"
2. Нажмите "Создать бакет"
3. Настройки бакета:
   - **Имя**: `manga-images-bucket` (или любое уникальное имя)
   - **Регион**: `ru-central1`
   - **Класс хранилища**: `Стандартное`
   - **Доступ на чтение**: `Публичный` (для отображения изображений)
   - **Доступ к списку объектов**: `Ограниченный`

## 4. Настройка CORS (для веб-доступа)

В настройках бакета добавьте CORS правило:

```json
[
  {
    "AllowedHeaders": ["*"],
    "AllowedMethods": ["GET", "HEAD"],
    "AllowedOrigins": ["*"],
    "MaxAgeSeconds": 3000
  }
]
```

## 5. Конфигурация приложения

Создайте файл `.env` на основе `.env.example`:

```bash
cp .env.example .env
```

Заполните переменные:

```env
YC_ACCESS_KEY=ваш-access-key-id
YC_SECRET_KEY=ваш-secret-access-key
YC_BUCKET_NAME=manga-images-bucket
```

## 6. Особенности Yandex Object Storage

### Эндпоинты:
- **Общий эндпоинт**: `https://storage.yandexcloud.net`
- **Региональный эндпоинт**: `https://storage.yandexcloud.net/ru-central1`

### URL изображений:
Изображения будут доступны по адресу:
`https://storage.yandexcloud.net/ваш-бакет/путь-к-файлу`

### Совместимость с S3:
- ✅ Поддерживается AWS S3 SDK
- ✅ Работает с Minio Java Client
- ✅ Совместим с MinIO конфигурацией

## 7. Тестирование

После настройки можно протестировать загрузку изображений:

1. Запустите приложение с `SPRING_PROFILES_ACTIVE=prod`
2. Загрузите тестовое изображение через API
3. Проверьте, что файл появился в бакете
4. Убедитесь, что изображение доступно по публичной ссылке

## 8. Стоимость

Yandex Object Storage тарифицируется по:
- **Хранение**: ~0.0015₽ за ГБ в месяц
- **Запросы**: ~0.004₽ за 1000 запросов GET
- **Трафик**: исходящий трафик платный (входящий бесплатный)

## 9. Мониторинг

В Yandex Cloud Console можно отслеживать:
- Размер бакета
- Количество объектов
- Статистику запросов
- Расходы на хранение
