# üöÄ –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –ó–∞–≥—Ä—É–∑–∫–∞ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ **—É–º–Ω–∞—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** –¥–ª—è MangaLib –ø–∞—Ä—Å–µ—Ä–∞, –∫–æ—Ç–æ—Ä–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø—Ä–æ–∫—Å–∏.

---

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–∫—Å–∏** (3, 10, 20, –∏–ª–∏ –ª—é–±–æ–µ –¥—Ä—É–≥–æ–µ)
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –≤–æ—Ä–∫–µ—Ä–æ–≤**: `min(proxy_count √ó 2, 10)`
  - 3 –ø—Ä–æ–∫—Å–∏ ‚Üí 3 –≤–æ—Ä–∫–µ—Ä–∞
  - 5 –ø—Ä–æ–∫—Å–∏ ‚Üí 5 –≤–æ—Ä–∫–µ—Ä–æ–≤
  - 10 –ø—Ä–æ–∫—Å–∏ ‚Üí 10 –≤–æ—Ä–∫–µ—Ä–æ–≤
  - 20+ –ø—Ä–æ–∫—Å–∏ ‚Üí –º–∞–∫—Å. 10 –≤–æ—Ä–∫–µ—Ä–æ–≤

### üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç Race Conditions
- **Thread-safe –æ–ø–µ—Ä–∞—Ü–∏–∏** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `Lock`
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –≥–ª–∞–≤ –º–∞–Ω–≥–∏)
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤** –∏–∑ temp –≤ —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é

### üìä –£–º–Ω—ã–π Throttling
- **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π rate limiting** –ø—Ä–∏ 429 –æ—à–∏–±–∫–∞—Ö
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ** –Ω–∞ 3x –ø—Ä–∏ rate limit
- **–≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π backoff** –¥–ª—è retry (1s ‚Üí 2s ‚Üí 4s)
- **Cooldown –ø–µ—Ä–∏–æ–¥** 30 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ 429

### üîÑ –ù–∞–¥–µ–∂–Ω–∞—è –û–±—Ä–∞–±–æ—Ç–∫–∞ –û—à–∏–±–æ–∫
- **3 –ø–æ–ø—ã—Ç–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏** —Å exponential backoff
- **Fallback –Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã** –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ
- **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞

---

## üìê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
MelonService/
‚îú‚îÄ‚îÄ Parsers/
‚îÇ   ‚îî‚îÄ‚îÄ mangalib/
‚îÇ       ‚îú‚îÄ‚îÄ parallel_downloader.py  ‚Üê –ù–û–í–´–ô: –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∑–∞–≥—Ä—É–∑—á–∏–∫
‚îÇ       ‚îî‚îÄ‚îÄ main.py                 ‚Üê –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω: batch_download_images()
‚îî‚îÄ‚îÄ Source/
    ‚îî‚îÄ‚îÄ Core/
        ‚îî‚îÄ‚îÄ Base/
            ‚îî‚îÄ‚îÄ Builders/
                ‚îî‚îÄ‚îÄ MangaBuilder.py  ‚Üê –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω: build_chapter()
```

### –ü–æ—Ç–æ–∫ –î–∞–Ω–Ω—ã—Ö

```
1. Parser.__init__()
   ‚îî‚îÄ‚îÄ _PostInitMethod()
       ‚îî‚îÄ‚îÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AdaptiveParallelDownloader
           ‚îú‚îÄ‚îÄ –ü–æ–¥—Å—á–µ—Ç –ø—Ä–æ–∫—Å–∏ (–∏–∑ settings.json –∏–ª–∏ ProxyRotator)
           ‚îú‚îÄ‚îÄ –†–∞—Å—á–µ—Ç –≤–æ—Ä–∫–µ—Ä–æ–≤ (proxy_count √ó 2, max 10)
           ‚îî‚îÄ‚îÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ delays (0.2s –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)

2. Builder.build_chapter(Title, chapter_id)
   ‚îî‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è batch_download_images()
       ‚îú‚îÄ‚îÄ ‚úÖ –ï—Å—Ç—å ‚Üí –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
       ‚îÇ   ‚îú‚îÄ‚îÄ –°–±–æ—Ä –≤—Å–µ—Ö URLs –∏–∑ chapter.slides
       ‚îÇ   ‚îú‚îÄ‚îÄ Parser.batch_download_images(urls)
       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AdaptiveParallelDownloader.download_batch()
       ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ ThreadPoolExecutor (N –≤–æ—Ä–∫–µ—Ä–æ–≤)
       ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å retry
       ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π throttling –ø—Ä–∏ 429
       ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ –í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –ø–æ—Ä—è–¥–∫–µ
       ‚îÇ   ‚îî‚îÄ‚îÄ –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ + –±–∏–ª–¥–∏–Ω–≥
       ‚îÇ
       ‚îî‚îÄ‚îÄ ‚ùå –ù–µ—Ç ‚Üí Fallback –Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### settings.json

```json
{
  "common": {
    "delay": 0.5,         // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤ (—Å–µ–∫)
    "image_delay": 0.2    // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (—Å–µ–∫)
  },
  "proxy": {
    "enable": true,
    "rotation": "round-robin",
    "proxies": [
      // –ß–µ–º –±–æ–ª—å—à–µ –ø—Ä–æ–∫—Å–∏, —Ç–µ–º –±–æ–ª—å—à–µ –≤–æ—Ä–∫–µ—Ä–æ–≤!
      {"server": "168.80.1.136:8000", "login": "PS20z2", "password": "fFNHVg"},
      {"server": "45.10.82.163:8000", "login": "aMLawA", "password": "PUShSd"},
      {"server": "45.10.82.201:8000", "login": "aMLawA", "password": "PUShSd"}
      // ... –¥–æ–±–∞–≤—å—Ç–µ –µ—â–µ 7 –ø—Ä–æ–∫—Å–∏ –¥–ª—è 10 –≤–æ—Ä–∫–µ—Ä–æ–≤
    ]
  }
}
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã AdaptiveParallelDownloader

```python
AdaptiveParallelDownloader(
    proxy_count=10,              # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–∫—Å–∏
    download_func=...,           # –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
    max_workers_per_proxy=2,     # –ü–æ—Ç–æ–∫–æ–≤ –Ω–∞ 1 –ø—Ä–æ–∫—Å–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 2)
    max_retries=3,               # –ü–æ–ø—ã—Ç–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 3)
    base_delay=0.2,              # –ë–∞–∑–æ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (—Å–µ–∫)
    retry_delay=1.0              # –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ retry (—Å–µ–∫)
)
```

---

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –¢–µ–∫—É—â–∞—è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (3 –ø—Ä–æ–∫—Å–∏)

| –ú–µ—Ç–æ–¥                | –ü–æ—Ç–æ–∫–æ–≤ | –°–∫–æ—Ä–æ—Å—Ç—å      | –í—Ä–µ–º—è (1000 img) |
|----------------------|---------|---------------|------------------|
| –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è     | 1       | 0.43 img/s    | ~38 –º–∏–Ω—É—Ç        |
| **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è (3)** | **3**   | **~1.3 img/s**| **~13 –º–∏–Ω—É—Ç**    |

**–£—Å–∫–æ—Ä–µ–Ω–∏–µ**: **~3x** ‚ö°

### –° 10 –ü—Ä–æ–∫—Å–∏ (–ü—Ä–æ–≥–Ω–æ–∑)

| –ú–µ—Ç–æ–¥                 | –ü–æ—Ç–æ–∫–æ–≤ | –°–∫–æ—Ä–æ—Å—Ç—å      | –í—Ä–µ–º—è (1000 img) |
|-----------------------|---------|---------------|------------------|
| **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è (10)** | **10**  | **~4 img/s**  | **~4 –º–∏–Ω—É—Ç—ã**    |

**–£—Å–∫–æ—Ä–µ–Ω–∏–µ**: **~10x** üöÄ

### –° 20 –ü—Ä–æ–∫—Å–∏ (–ú–∞–∫—Å–∏–º—É–º)

| –ú–µ—Ç–æ–¥                 | –ü–æ—Ç–æ–∫–æ–≤ | –°–∫–æ—Ä–æ—Å—Ç—å      | –í—Ä–µ–º—è (1000 img) |
|-----------------------|---------|---------------|------------------|
| **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è (20)** | **10*** | **~5 img/s**  | **~3 –º–∏–Ω—É—Ç—ã**    |

\* *–û–≥—Ä–∞–Ω–∏—á–µ–Ω–æ 10 –≤–æ—Ä–∫–µ—Ä–∞–º–∏ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏*

**–£—Å–∫–æ—Ä–µ–Ω–∏–µ**: **~12x** üî•

---

## üîç –ü—Ä–∏–º–µ—Ä –í—ã–≤–æ–¥–∞

```
[INFO] üåê Detected 10 proxies from settings
[INFO] üöÄ ParallelDownloader initialized: 10 workers for 10 proxies (ratio: 2:1)

[INFO] üöÄ Starting parallel download of 1064 images...
üì• Downloaded 10/1064 images (0.9%)
üì• Downloaded 50/1064 images (4.7%)
üì• Downloaded 100/1064 images (9.4%)
...
‚ö†Ô∏è Rate limit detected! Slowing down (delay: 0.6s)
...
üì• Downloaded 1064/1064 images (100.0%)

‚úÖ Batch download completed: 1064/1064 successful, 0 failed, 245.2s elapsed (4.34 img/sec)

[INFO] ‚úÖ Chapter download completed: 1064 images
```

---

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ó–∞—â–∏—Ç–∞ –æ—Ç Rate Limiting

1. **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ 429**:
   ```python
   if '429' in str(e) or 'too many requests' in str(e).lower():
       self._handle_rate_limit()
   ```

2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ**:
   - Delay —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –≤ **3 —Ä–∞–∑–∞**
   - –ê–∫—Ç–∏–≤–µ–Ω **30 —Å–µ–∫—É–Ω–¥** –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π 429
   - –ó–∞—Ç–µ–º –≤–æ–∑–≤—Ä–∞—Ç –∫ –±–∞–∑–æ–≤–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏

3. **Exponential Backoff**:
   - 1-—è –ø–æ–ø—ã—Ç–∫–∞: delay
   - 2-—è –ø–æ–ø—ã—Ç–∫–∞: delay √ó 2
   - 3-—è –ø–æ–ø—ã—Ç–∫–∞: delay √ó 4

### Thread Safety

```python
# –°—á—ë—Ç—á–∏–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã Lock
with self._lock:
    self._downloaded += 1
    current = self._downloaded
    total = self._total

# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ index –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞
results.sort(key=lambda x: x['index'])
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ê–¥–∞–ø—Ç–∞—Ü–∏–∏

```python
# –¢–µ—Å—Ç 1: 3 –ø—Ä–æ–∫—Å–∏ ‚Üí 3 –≤–æ—Ä–∫–µ—Ä–∞
proxy_count = 3
downloader = AdaptiveParallelDownloader(proxy_count=proxy_count, ...)
assert downloader.max_workers == 3

# –¢–µ—Å—Ç 2: 10 –ø—Ä–æ–∫—Å–∏ ‚Üí 10 –≤–æ—Ä–∫–µ—Ä–æ–≤
proxy_count = 10
downloader = AdaptiveParallelDownloader(proxy_count=proxy_count, ...)
assert downloader.max_workers == 10

# –¢–µ—Å—Ç 3: 50 –ø—Ä–æ–∫—Å–∏ ‚Üí 10 –≤–æ—Ä–∫–µ—Ä–æ–≤ (–ª–∏–º–∏—Ç)
proxy_count = 50
downloader = AdaptiveParallelDownloader(proxy_count=proxy_count, ...)
assert downloader.max_workers == 10
```

### –ó–∞–ø—É—Å–∫ –ë–∏–ª–¥–∞

```bash
# –ü–∞—Ä—Å–∏–Ω–≥ + –±–∏–ª–¥
python main.py parse-manga sweet-home-kim-carnby- --use mangalib
python main.py build-manga sweet-home-kim-carnby- --use mangalib -simple

# –õ–æ–≥–∏ –ø–æ–∫–∞–∂—É—Ç:
# [INFO] üöÄ Starting parallel download of XXX images...
# ‚úÖ Batch download completed: XXX/XXX successful
```

---

## üìù –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### Backward Compatibility

‚úÖ **–ü–æ–ª–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**:

```python
# –ï—Å–ª–∏ batch_download_images() –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí fallback
if hasattr(Parser, 'batch_download_images'):
    # –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
    filenames = Parser.batch_download_images(urls)
else:
    # –°—Ç–∞—Ä—ã–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥
    for Slide in TargetChapter.slides:
        Parser.image(Link)
```

### –î—Ä—É–≥–∏–µ –ü–∞—Ä—Å–µ—Ä—ã

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –¥—Ä—É–≥–∏–µ –ø–∞—Ä—Å–µ—Ä—ã (remanga, desu, etc):

1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å `parallel_downloader.py`
2. –î–æ–±–∞–≤–∏—Ç—å –≤ `_PostInitMethod()`:
   ```python
   proxy_count = self._get_proxy_count()
   self._parallel_downloader = AdaptiveParallelDownloader(...)
   ```
3. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã:
   - `_get_proxy_count()`
   - `batch_download_images()`
   - `_try_alternative_servers()`

---

## üéì –ö–∞–∫ –≠—Ç–æ –†–∞–±–æ—Ç–∞–µ—Ç

### 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–∞—Ä—Å–µ—Ä–∞)

```python
# MangaLib Parser.__init__()
#   ‚îî‚îÄ‚îÄ _PostInitMethod()
#       ‚îî‚îÄ‚îÄ self._parallel_downloader = AdaptiveParallelDownloader(
#               proxy_count=3,  # ‚Üê –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
#               download_func=self._ImagesDownloader.temp_image
#           )
#
# –†–µ–∑—É–ª—å—Ç–∞—Ç: 3 –≤–æ—Ä–∫–µ—Ä–∞ –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–±–æ—Ç–µ
```

### 2. –ë–∏–ª–¥ –ì–ª–∞–≤—ã

```python
# Builder.build_chapter(title, chapter_id)
urls = ["https://img1.mangalib.me/...", "https://img2.mangalib.me/...", ...]

# –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
results = Parser.batch_download_images(urls)
#   ‚îî‚îÄ‚îÄ AdaptiveParallelDownloader.download_batch(urls)
#       ‚îú‚îÄ‚îÄ ThreadPoolExecutor(max_workers=3)
#       ‚îú‚îÄ‚îÄ –í–æ—Ä–∫–µ—Ä 1: urls[0], urls[3], urls[6], ...
#       ‚îú‚îÄ‚îÄ –í–æ—Ä–∫–µ—Ä 2: urls[1], urls[4], urls[7], ...
#       ‚îî‚îÄ‚îÄ –í–æ—Ä–∫–µ—Ä 3: urls[2], urls[5], urls[8], ...
```

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```python
# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
for idx, (Slide, filename) in enumerate(zip(slides, filenames)):
    if filename:
        # –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Ñ–∞–π–ª –∏–∑ temp
        move_from_temp(filename)
        # –ë–∏–ª–¥–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
        build_system(title, chapter, directory)
```

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "AttributeError: 'Parser' object has no attribute '_parallel_downloader'"

**–ü—Ä–∏—á–∏–Ω–∞**: –ó–∞–≥—Ä—É–∑—á–∏–∫ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω  
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `_PostInitMethod()` –≤ –ø–∞—Ä—Å–µ—Ä–µ

### –ü—Ä–æ–±–ª–µ–º–∞: "Too many 429 errors"

**–ü—Ä–∏—á–∏–Ω–∞**: –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≤–æ—Ä–∫–µ—Ä–æ–≤ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–∫—Å–∏  
**–†–µ—à–µ–Ω–∏–µ**: 
- –£–º–µ–Ω—å—à–∏—Ç—å `max_workers_per_proxy` (—Å 2 –¥–æ 1)
- –£–≤–µ–ª–∏—á–∏—Ç—å `image_delay` (—Å 0.2 –¥–æ 0.3)
- –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –ø—Ä–æ–∫—Å–∏

### –ü—Ä–æ–±–ª–µ–º–∞: "Images downloaded in wrong order"

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ index  
**–ü—Ä–æ–≤–µ—Ä–∫–∞**:
```python
results.sort(key=lambda x: x['index'])  # –í—Å–µ–≥–¥–∞ —Å–æ—Ä—Ç–∏—Ä—É–µ–º
```

---

## üìö API Reference

### AdaptiveParallelDownloader

```python
class AdaptiveParallelDownloader:
    def __init__(
        self,
        proxy_count: int,                           # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–∫—Å–∏
        download_func: Callable[[str], str | None], # –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
        max_workers_per_proxy: int = 2,             # –ü–æ—Ç–æ–∫–æ–≤/–ø—Ä–æ–∫—Å–∏
        max_retries: int = 3,                       # –ü–æ–ø—ã—Ç–æ–∫
        base_delay: float = 0.2,                    # –ó–∞–¥–µ—Ä–∂–∫–∞ (—Å–µ–∫)
        retry_delay: float = 1.0                    # –ó–∞–¥–µ—Ä–∂–∫–∞ retry (—Å–µ–∫)
    )
    
    def download_batch(
        self,
        urls: List[str],                            # –°–ø–∏—Å–æ–∫ URL
        progress_callback: Callable[[int, int], None] = None
    ) -> List[Dict[str, Any]]                       # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç download_batch()

```python
[
    {
        'success': True,
        'filename': 'temp_image_001.jpg',
        'url': 'https://...',
        'attempts': 1,
        'index': 1
    },
    {
        'success': False,
        'filename': None,
        'url': 'https://...',
        'attempts': 3,
        'error': '404 Not Found',
        'index': 2
    },
    ...
]
```

---

## ‚úÖ Checklist –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

- [x] –°–æ–∑–¥–∞–Ω `parallel_downloader.py`
- [x] –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω `MangaLib/main.py`
  - [x] –ò–º–ø–æ—Ä—Ç `AdaptiveParallelDownloader`
  - [x] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ `_PostInitMethod()`
  - [x] –ú–µ—Ç–æ–¥ `_get_proxy_count()`
  - [x] –ú–µ—Ç–æ–¥ `batch_download_images()`
  - [x] –ú–µ—Ç–æ–¥ `_try_alternative_servers()`
- [x] –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω `MangaBuilder.py`
  - [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ `hasattr(Parser, 'batch_download_images')`
  - [x] –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
  - [x] Fallback –Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥
- [x] Syntax check –ø—Ä–æ–π–¥–µ–Ω
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ `settings.json`: `image_delay: 0.2`
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–π –º–∞–Ω–≥–µ
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ 429 –æ—à–∏–±–æ–∫
- [ ] –†–∞—Å—à–∏—Ä–∏—Ç—å –¥–æ 10 –ø—Ä–æ–∫—Å–∏ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏

---

## üöÄ Roadmap

### v1.1 (–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è)
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ Thread-safe –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –£–º–Ω—ã–π throttling
- ‚úÖ Fallback –Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã

### v1.2 (–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- [ ] –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø—Ä–æ–∫—Å–∏ (—Å–∫–æ—Ä–æ—Å—Ç—å, –æ—à–∏–±–∫–∏)
- [ ] Auto-ban –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø—Ä–æ–∫—Å–∏
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### v2.0 (–ë—É–¥—É—â–µ–µ)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –¥—Ä—É–≥–∏–µ –ø–∞—Ä—Å–µ—Ä—ã (remanga, desu)
- [ ] Web UI –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∑–∞–≥—Ä—É–∑–æ–∫
- [ ] Metrics –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- [ ] Cloud-based –ø—Ä–æ–∫—Å–∏ —Ä–æ—Ç–∞—Ü–∏—è

---

**–í–µ—Ä—Å–∏—è**: 1.0  
**–î–∞—Ç–∞**: 2025-01-07  
**–ê–≤—Ç–æ—Ä**: GitHub Copilot  
**–õ–∏—Ü–µ–Ω–∑–∏—è**: MIT
