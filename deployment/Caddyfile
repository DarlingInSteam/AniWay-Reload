{
    email {$ACME_EMAIL}
}

https://aniway.space {
    encode zstd gzip
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        Referrer-Policy "no-referrer-when-downgrade"
        X-Content-Type-Options "nosniff"
    }

    handle /.well-known/acme-challenge/* {
        root * /srv/verifications
        file_server
    }

    # API requests to Gateway Service
    handle /api/* {
        reverse_proxy gateway-service:8080
    }

    # WebSocket connections
    handle /ws/* {
        reverse_proxy gateway-service:8080 {
            header_up Connection "Upgrade"
            header_up Upgrade "websocket"
        }
    }

    # All other requests to frontend
    reverse_proxy aniway-frontend:80
}

http://aniway.space {
    handle /.well-known/acme-challenge/* {
        root * /srv/verifications
        file_server
    }

    redir https://aniway.space{uri}
}
