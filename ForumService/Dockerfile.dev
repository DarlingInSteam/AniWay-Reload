# Dockerfile.dev для ForumService (Development)
FROM openjdk:21-jdk-slim

# Установка переменных окружения для разработки
ENV SPRING_PROFILES_ACTIVE=dev
ENV SPRING_DEVTOOLS_RESTART_ENABLED=true

# Установка рабочей директории
WORKDIR /app

# Установка curl для healthcheck
RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*

# Копирование gradle wrapper
COPY gradlew .
COPY gradle gradle

# Копирование файлов сборки
COPY build.gradle.kts .
COPY settings.gradle.kts .

# Установка прав на выполнение для gradlew
RUN chmod +x ./gradlew

# Загрузка зависимостей
RUN ./gradlew dependencies --no-daemon

# Экспорт порта
EXPOSE 8087

# Volume для live reload
VOLUME ["/app/src"]

# Команда запуска в dev режиме с live reload
CMD ["./gradlew", "bootRun", "--no-daemon", "--continuous"]